# MongoDB

## Introduction

- a general purpose document database, structure data into documents similar to JSON objects
- not using the relational database schemas of tables, columns or rows
- offers a developer-friendly way to access the data
- corresponds objects in code
- document model is easier to plan how application data will correspond to data in the databases
- model data of any shape or structure
- use one format for every language

```javascript
    // example of a document
    {
        "id" : 1,
        "name" : {
            "first" : "Ada",
            "last" : "Lovelace"
        },
        "title" : "The First Programmer",
        "interests" : ["mathematics", "programming"]
    }
```

- **document** is the basic unit of data in MongoDB
- a **Collection** is grouping of those documents
- a **Database** is the container of collections.
- MongoDB Database is the core of Atlas

## document model

- documents are displayed in JSON but stored in BSON(Binary JSON) -> BSON also adds support for datatypes unavailable in JSON
- _ObjectID_ a special datatype to create unique identifiers in MongoDB
- every document requires an \_id field that acts as a primary key, if not provided then ObjectId is automatically generated by MongoDB
- The values in a document can be any data type, including strings, objects, arrays, booleans, nulls, dates, ObjectIds, and more.

```javascript

{
    "key" : value,
    "key" : value,
    "key" : value,
}

// example

{
    "_id" : 1,
    "name" : "AC3 Phone",
    "colors" : ["black", "silver"],
    "price" : 200,
    "available" : true
}


```

## MongoDB Connection String

- allows us to connect to our cluster and work with our data and options for connecting to our MongoDB Database
- has two formats for connection string:
  1. standard format : used to connect to standalone clusters, replica sets, or sharded ckusters
  2. DNS seed list format
     - provides a DNS server list to our connection string
     - Gives more flexibility of deployment
     - ability to change servers in rotation without reconfiguring clients
- The connection list from the Atlas dashboard, uses a _DNS seed list entry_, which has a list of hosts that can be connected with.
  ### Connection String
  - example of connection string : **mongodb+srv://{username}:{password}@cluster0.usqsf.mongodb.net/?retryWrites=true&w=majority**
  - begins with the required prefix _mongodb_ that identifies it is as a mongoDB connection string,
  - the _+srv_ automatically sets the TLS security option to true and tells mongoDB to use the DNS seed list
  - then the _username_ and _password_ of the database in Atlas dashboard
  - _@cluster0.usqsf.mongodb.net_ - host and the optional port number to our database(if not specified then default port number is 27017)
  - any extra optional query parameters for additional information : here _retryWrites=true_ means to retry the write ops when failed

## MongoDB Shell

- a NodeJS REPL environment that gives access to JS variables, loops, control structures, etc.

## MongoDB Compass

- a GUI, that allows us to query and analyse our data, and compose aggregation pipelines

## Connection Errors

- mainly two types of errors:
  1. Network Access Errors - If IP Address isn't allowed by the MongoDB
  2. User Authentication Errors - If anything goes wrong in the connection string

## Inserting documents in MongoDB

- two methods used to insert documents in MongoDB:
  1. **insertOne()**:
     - used to insert one document at a time
     - Syntax { db.collectionName.insertOne() }
     - if the specified collection name doesn't exist then, mongoDB automatically creates that collection and inserts the data to it.
     - the document parameters are inserted inside the parenthesis of insertOne method.
     ```javascript
     db.grades.insertOne({
       student_id: 654321,
       products: [
         {
           type: "exam",
           score: 90,
         },
         {
           type: "homework",
           score: 59,
         },
         {
           type: "quiz",
           score: 75,
         },
         {
           type: "homework",
           score: 88,
         },
       ],
       class_id: 550,
     });
     ```
  2. **insertMany()**:
     - inserts many document at a time
     - expects an array of documents
     - Syntax { db.collectionName.insertMany(
       (document_1), (document_2), (document_3), etc.
       ) }
     ```javascript
     db.grades.insertMany([
       {
         student_id: 546789,
         products: [
           {
             type: "quiz",
             score: 50,
           },
           {
             type: "homework",
             score: 70,
           },
           {
             type: "quiz",
             score: 60,
           },
           {
             type: "exam",
             score: 80,
           },
         ],
         class_id: 551,
       },
       {
         student_id: 777777,
         products: [
           {
             type: "quiz",
             score: 50,
           },
           {
             type: "homework",
             score: 70,
           },
           {
             type: "quiz",
             score: 60,
           },
           {
             type: "exam",
             score: 80,
           },
         ],
         class_id: 458,
       },
       {
         student_id: 645372,
         products: [
           {
             type: "quiz",
             score: 50,
           },
           {
             type: "homework",
             score: 70,
           },
           {
             type: "quiz",
             score: 60,
           },
           {
             type: "exam",
             score: 80,
           },
         ],
         class_id: 271,
       },
     ]);
     ```

## Finding documents

- **find()**:
  - syntax
  ```javascript
  db.collectionName.find();
  ```
  - use **it** shell directive for more results
- to find a specific document:

  - for single document finding
  - **$eq** operator

  ```javascript
   {field : {$eq : <value>}}
   // or this
   {field : <value>}

   // in action
   db.collectionName.find({field : {$eq : <value>}})
   db.collectionName.find({field : <value>})
  ```

- **$in**:
  - The **$in** operator allows us to select all the documents that have a field value equal to any of the values specified in the array.
  - multiple documents finding
  ```javascript
  // db.collectionName.find({field : {$in : [value1, value2, etc...]}})
  db.zips.find({ city: { $in: ["Phoenix", "Chicago"] } });
  ```
